-- Drizzle migration file
-- This file is auto-generated and should be reviewed before running

CREATE TABLE IF NOT EXISTS `agents` (
  `id` text PRIMARY KEY NOT NULL,
  `name` text NOT NULL,
  `twitter_handle` text,
  `elo` integer NOT NULL DEFAULT 1200,
  `matches_played` integer NOT NULL DEFAULT 0,
  `wins` integer NOT NULL DEFAULT 0,
  `losses` integer NOT NULL DEFAULT 0,
  `high_score` integer NOT NULL DEFAULT 0,
  `average_score` real NOT NULL DEFAULT 0,
  `created_at` integer NOT NULL,
  `updated_at` integer NOT NULL
);

CREATE TABLE IF NOT EXISTS `matches` (
  `id` text PRIMARY KEY NOT NULL,
  `status` text CHECK(`status` IN ('pending', 'in_progress', 'completed', 'cancelled')) NOT NULL DEFAULT 'pending',
  `agent1_id` text REFERENCES `agents`(`id`),
  `agent2_id` text REFERENCES `agents`(`id`),
  `winner_id` text REFERENCES `agents`(`id`),
  `agent1_score` integer NOT NULL DEFAULT 0,
  `agent2_score` integer NOT NULL DEFAULT 0,
  `agent1_frames` text NOT NULL,
  `agent2_frames` text NOT NULL,
  `replay_data` text NOT NULL,
  `spectators` integer NOT NULL DEFAULT 0,
  `started_at` integer,
  `completed_at` integer,
  `created_at` integer NOT NULL
);

CREATE TABLE IF NOT EXISTS `match_queue` (
  `id` text PRIMARY KEY NOT NULL,
  `agent_id` text NOT NULL REFERENCES `agents`(`id`),
  `status` text CHECK(`status` IN ('waiting', 'matched', 'expired')) NOT NULL DEFAULT 'waiting',
  `preferred_elo_range` integer NOT NULL DEFAULT 100,
  `created_at` integer NOT NULL
);

CREATE INDEX IF NOT EXISTS `idx_agents_elo` ON `agents`(`elo`);
CREATE INDEX IF NOT EXISTS `idx_matches_status` ON `matches`(`status`);
CREATE INDEX IF NOT EXISTS `idx_match_queue_agent` ON `match_queue`(`agent_id`);
